<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Test ‚Äì Gener√°tor</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    #progressBox {
      text-align: right;
      font-weight: bold;
      font-size: 16px;
      color: #0d47a1;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<header>
  <h1>üß† Test ‚Äì Gener√°tor ot√°zok</h1>
</header>

<main>
  <div id="testContainer" class="form">
    <div id="progressBox"></div>
    <h2 id="nazovTestu"></h2>
    <div id="otazkaText"></div>
    <div id="odpovede"></div>
    <div class="button-group" id="buttons">
      <button id="spat">Sp√§≈•</button>
      <button id="skontroluj">Skontroluj ot√°zku</button>
      <button id="dalsia">ƒéal≈°ia ot√°zka</button>
    </div>
    <div id="scoreBox" style="display:none;"></div> <!-- ‚úÖ skryt√© poƒças testu -->
    <div id="vysledky"></div>
  </div>
</main>

<script>
  const otazky = JSON.parse(localStorage.getItem("otazky") || "[]");
  const odpovede = JSON.parse(localStorage.getItem("odpovede") || "[]");
  const jeBio = localStorage.getItem("jeBio") === "true";
  const mix = JSON.parse(localStorage.getItem("mix") || "false");

  otazky.forEach(q => {
    q.odpovede = q.odpovede.map((text, index) => ({
      text,
      povodnePismeno: String.fromCharCode(65 + index)
    }));
    if (mix) q.odpovede.sort(() => Math.random() - 0.5);
  });

  const nazov = document.getElementById("nazovTestu");
  const otazkaText = document.getElementById("otazkaText");
  const odpovedeDiv = document.getElementById("odpovede");
  const btnSkontroluj = document.getElementById("skontroluj");
  const btnDalsia = document.getElementById("dalsia");
  const btnSpat = document.getElementById("spat");
  const buttons = document.getElementById("buttons");
  const scoreBox = document.getElementById("scoreBox");
  const vysledkyDiv = document.getElementById("vysledky");
  const progressBox = document.getElementById("progressBox");

  let index = 0;
  let body = 0;

  nazov.textContent = jeBio ? "Biol√≥gia" : "Ch√©mia";

  function zobrazOtazku() {
    if (index >= otazky.length) { ukonciTest(); return; }

    const o = otazky[index];
    otazkaText.textContent = o.cislo + ". " + o.text;

    progressBox.textContent = `Ot√°zka ${index + 1} z ${otazky.length}`;

    odpovedeDiv.innerHTML = "";
    for (let i = 0; i < o.odpovede.length; i++) {
      const pism = String.fromCharCode(65 + i);
      const div = document.createElement("div");
      div.className = "odpoved";

      const label = document.createElement("label");
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.name = "odp";
      checkbox.value = o.odpovede[i].povodnePismeno;
      label.appendChild(checkbox);
      label.appendChild(document.createTextNode(" " + pism + ". " + o.odpovede[i].text));
      div.appendChild(label);
      odpovedeDiv.appendChild(div);
    }

    btnSkontroluj.disabled = false;
  }

  function skontroluj() {
    const currentOt = otazky[index];
    const cisloOtazky = currentOt.cislo;

    const spravne = odpovede
      .filter(x => x.cislo === cisloOtazky)
      .flatMap(x => x.odpoved);

    const oznacene = Array.from(document.querySelectorAll('input[name="odp"]:checked'))
      .map(el => el.value);

    const moznosti = document.querySelectorAll(".odpoved");
    moznosti.forEach(div => {
      const checkbox = div.querySelector('input[name="odp"]');
      const pism = checkbox.value;
      if (spravne.includes(pism) && oznacene.includes(pism)) div.classList.add("correct");
      else if (spravne.includes(pism) && !oznacene.includes(pism)) div.classList.add("partial-correct");
      else if (!spravne.includes(pism) && oznacene.includes(pism)) div.classList.add("incorrect");
    });

    const vseSpravne = spravne.every(s => oznacene.includes(s));
    const ziadneZle = oznacene.every(o => spravne.includes(o));
    if (vseSpravne && ziadneZle) body++;

    document.querySelectorAll('input[name="odp"]').forEach(i => i.disabled = true);
    btnSkontroluj.disabled = true;
  }

  function dalsia() { index++; zobrazOtazku(); }
  function spat() { if (index > 0) { index--; zobrazOtazku(); } }

  function ukonciTest() {
    otazkaText.textContent = "üéâ Test je dokonƒçen√Ω!";
    odpovedeDiv.innerHTML = "";
    buttons.style.display = "none";
    progressBox.textContent = "";

    // ‚úÖ teraz zobraz√≠me sk√≥re a≈æ na konci
    scoreBox.style.display = "block";
    scoreBox.textContent = "‚úÖ V√Ωsledok: " + body + " z " + otazky.length;

    const btnOpakovat = document.createElement("button");
    btnOpakovat.textContent = "üîÅ Opakova≈• test";
    btnOpakovat.className = "button-restart";
    btnOpakovat.addEventListener("click", () => {
      index = 0;
      body = 0;
      vysledkyDiv.innerHTML = "";
      buttons.style.display = "flex";
      scoreBox.style.display = "none";
      zobrazOtazku();
    });

    const btnDomov = document.createElement("button");
    btnDomov.textContent = "‚û°Ô∏è ƒéal≈°√≠ test";
    btnDomov.className = "button-domov";
    btnDomov.addEventListener("click", () => window.location.href = "index.html");

    vysledkyDiv.innerHTML = "";
    vysledkyDiv.appendChild(btnOpakovat);
    vysledkyDiv.appendChild(btnDomov);
  }

  btnSkontroluj.addEventListener("click", skontroluj);
  btnDalsia.addEventListener("click", dalsia);
  btnSpat.addEventListener("click", spat);

  zobrazOtazku();
</script>
</body>
</html>
