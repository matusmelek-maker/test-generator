<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Test ‚Äì Gener√°tor</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header>
  <h1>üß† Test ‚Äì Gener√°tor ot√°zok</h1>
</header>

<main>
  <div id="testContainer" class="form">
    <h2 id="nazovTestu"></h2>
    <div id="otazkaText"></div>
    <div id="odpovede"></div>
    <div class="button-group" id="buttons">
      <button id="spat">Sp√§≈•</button>
      <button id="skontroluj">Skontroluj ot√°zku</button>
      <button id="dalsia">ƒéal≈°ia ot√°zka</button>
    </div>
    <div id="scoreBox"></div>
    <div id="vysledky"></div>
  </div>
</main>

<script>
  const otazky = JSON.parse(localStorage.getItem("otazky") || "[]");
  const odpovede = JSON.parse(localStorage.getItem("odpovede") || "[]");
  const jeBio = localStorage.getItem("jeBio") === "true";

  const nazov = document.getElementById("nazovTestu");
  const otazkaText = document.getElementById("otazkaText");
  const odpovedeDiv = document.getElementById("odpovede");
  const btnSkontroluj = document.getElementById("skontroluj");
  const btnDalsia = document.getElementById("dalsia");
  const btnSpat = document.getElementById("spat");
  const buttons = document.getElementById("buttons");
  const scoreBox = document.getElementById("scoreBox");
  const vysledkyDiv = document.getElementById("vysledky");

  let index = 0;
  let body = 0;
  let vybraneOdpovede = {};

  nazov.textContent = jeBio ? "Biol√≥gia" : "Ch√©mia";

  function zobrazOtazku() {
    if (index >= otazky.length) { ukonciTest(); return; }

    const o = otazky[index];
    otazkaText.textContent = o.cislo + ". " + o.text;

    odpovedeDiv.innerHTML = "";
    for (let i = 0; i < o.odpovede.length; i++) {
      const pism = String.fromCharCode(65 + i);
      const div = document.createElement("div");
      div.className = "odpoved";

      const label = document.createElement("label");
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.name = "odp";
      checkbox.value = pism;
      label.appendChild(checkbox);
      label.appendChild(document.createTextNode(" " + pism + ". " + o.odpovede[i]));
      div.appendChild(label);
      odpovedeDiv.appendChild(div);
    }

    const ozn = vybraneOdpovede[o.cislo];
    if (Array.isArray(ozn)) {
      requestAnimationFrame(function() {
        for (const p of ozn) {
          const el = document.querySelector('input[name="odp"][value="' + p + '"]');
          if (el) el.checked = true;
        }
      });
    }

    btnSkontroluj.disabled = false;
    scoreBox.textContent = "üìä Sk√≥re: " + body + " / " + otazky.length;
  }

  function skontroluj() {
    const currentOt = otazky[index];
    const cisloOtazky = currentOt.cislo;

    const spravne = odpovede
      .filter(x => x.cislo === cisloOtazky)
      .flatMap(x => x.odpoved); // pole p√≠smen

    const oznacene = Array.from(document.querySelectorAll('input[name="odp"]:checked'))
      .map(el => el.value);

    vybraneOdpovede[cisloOtazky] = oznacene.slice();

    const moznosti = document.querySelectorAll(".odpoved");
    moznosti.forEach(div => {
      const checkbox = div.querySelector('input[name="odp"]');
      const pism = checkbox.value;

      div.classList.remove("correct","partial-correct","incorrect","partial-incorrect");

      if (spravne.includes(pism) && oznacene.includes(pism)) {
        div.classList.add("correct");
      } else if (spravne.includes(pism) && !oznacene.includes(pism)) {
        div.classList.add("partial-correct");
      } else if (!spravne.includes(pism) && oznacene.includes(pism)) {
        div.classList.add("incorrect");
      } else {
        div.classList.add("partial-incorrect");
      }
    });

    const vseSpravne = spravne.every(s => oznacene.includes(s));
    const ziadneZle = oznacene.every(o => spravne.includes(o));
    if (vseSpravne && ziadneZle) body++;

    document.querySelectorAll('input[name="odp"]').forEach(i=>i.disabled=true);
    btnSkontroluj.disabled = true;
    scoreBox.textContent = `üìä Sk√≥re: ${body} / ${otazky.length}`;
  }

  function dalsia() { index++; zobrazOtazku(); }
  function spat() { if(index>0){ index--; zobrazOtazku(); } }

  function ukonciTest() {
    otazkaText.textContent = "üéâ Test je dokonƒçen√Ω!";
    odpovedeDiv.innerHTML = "";
    buttons.style.display = "none";
    scoreBox.textContent = "‚úÖ V√Ωsledok: " + body + " z " + otazky.length;

    vysledkyDiv.innerHTML = "";
    const nadpis = document.createElement("h3");
    nadpis.textContent = "üìã Prehƒæad ot√°zok:";
    vysledkyDiv.appendChild(nadpis);

    for (let i = 0; i < otazky.length; i++) {
      const o = otazky[i];
      const cisloOtazky = o.cislo;
      const spravne = odpovede.filter(x=>x.cislo===cisloOtazky).flatMap(x=>x.odpoved);
      const ozn = vybraneOdpovede[cisloOtazky] || [];

      const blok = document.createElement("div");
      blok.className = "vysledokOtazka";

      const qTitle = document.createElement("p");
      qTitle.innerHTML = "<strong>" + o.cislo + ". " + o.text + "</strong>";
      blok.appendChild(qTitle);

      const ul = document.createElement("ul");
      ul.style.listStyleType="none"; ul.style.paddingLeft="10px";

      for (let j=0;j<o.odpovede.length;j++) {
        const pism = String.fromCharCode(65+j);
        const text = o.odpovede[j];
        const li = document.createElement("li");

        if (spravne.includes(pism)) li.className="correct";
        else if (ozn.includes(pism)) li.className="incorrect";
        else li.className="";

        li.textContent = pism + ". " + text;
        ul.appendChild(li);
      }

      blok.appendChild(ul);
      blok.appendChild(document.createElement("hr"));
      vysledkyDiv.appendChild(blok);
    }

    const btnDomov = document.createElement("button");
    btnDomov.textContent = "‚û°Ô∏è ƒéal≈°√≠ test";
    btnDomov.className = "button-domov";
    btnDomov.addEventListener("click",()=>window.location.href="index.html");
    vysledkyDiv.appendChild(btnDomov);
  }

  btnSkontroluj.addEventListener("click", skontroluj);
  btnDalsia.addEventListener("click", dalsia);
  btnSpat.addEventListener("click", spat);

  zobrazOtazku();
</script>
</body>
</html>
