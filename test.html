<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Test ‚Äì Gener√°tor</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    #progressBox {
      text-align: right;
      font-weight: bold;
      font-size: 16px;
      color: #0d47a1;
      margin-bottom: 10px;
    }

    #finishText {
      text-align: center;
      font-size: 22px;
      font-weight: 700;
      color: #1565C0;
      margin: 25px 0 10px 0;
      animation: fadeIn 0.8s ease-in-out;
    }
  </style>
</head>
<body>

<header>
  <h1>üß† Test ‚Äì Gener√°tor ot√°zok</h1>
</header>

<main>
  <div id="testContainer" class="form">
    <div id="progressBox"></div>
    <h2 id="nazovTestu"></h2>
    <div id="otazkaText"></div>
    <div id="odpovede"></div>
    <div class="button-group" id="buttons">
      <button id="spat">Sp√§≈•</button>
      <button id="skontroluj">Skontroluj ot√°zku</button>
      <button id="dalsia">ƒéal≈°ia ot√°zka</button>
    </div>
    <div id="scoreBox" style="display:none;"></div>
    <div id="vysledky"></div>
  </div>
</main>

<script>
  const otazky = JSON.parse(localStorage.getItem("otazky") || "[]");
  const odpovede = JSON.parse(localStorage.getItem("odpovede") || "[]");
  const jeBio = localStorage.getItem("jeBio") === "true";
  const mix = JSON.parse(localStorage.getItem("mix") || "false");

  otazky.forEach(q => {
    q.odpovede = q.odpovede.map((text, index) => ({
      text,
      povodnePismeno: String.fromCharCode(65 + index)
    }));
    if (mix) q.odpovede.sort(() => Math.random() - 0.5);
  });

  const nazov = document.getElementById("nazovTestu");
  const otazkaText = document.getElementById("otazkaText");
  const odpovedeDiv = document.getElementById("odpovede");
  const btnSkontroluj = document.getElementById("skontroluj");
  const btnDalsia = document.getElementById("dalsia");
  const btnSpat = document.getElementById("spat");
  const buttons = document.getElementById("buttons");
  const scoreBox = document.getElementById("scoreBox");
  const vysledkyDiv = document.getElementById("vysledky");
  const progressBox = document.getElementById("progressBox");

  let index = 0;
  let body = 0;
  const vybraneOdpovede = {};

  nazov.textContent = jeBio ? "Biol√≥gia" : "Ch√©mia";

  function zobrazOtazku() {
    if (index >= otazky.length) { ukonciTest(); return; }

    const o = otazky[index];
    otazkaText.textContent = o.cislo + ". " + o.text;
    progressBox.textContent = `Ot√°zka ${index + 1} z ${otazky.length}`;

    odpovedeDiv.innerHTML = "";
    o.odpovede.forEach((odp, i) => {
      const pism = String.fromCharCode(65 + i);
      const div = document.createElement("div");
      div.className = "odpoved";

      const label = document.createElement("label");
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.name = "odp";
      checkbox.value = odp.povodnePismeno;

      // klik na cel√Ω blok
      div.addEventListener("click", () => {
        checkbox.checked = !checkbox.checked;
      });

      label.appendChild(checkbox);
      label.appendChild(document.createTextNode(" " + pism + ". " + odp.text));
      div.appendChild(label);
      odpovedeDiv.appendChild(div);
    });

    btnSkontroluj.disabled = false;
  }

  function skontroluj(auto = false) {
    const currentOt = otazky[index];
    const cisloOtazky = currentOt.cislo;

    const spravne = odpovede.filter(x => x.cislo === cisloOtazky).flatMap(x => x.odpoved);
    const oznacene = Array.from(document.querySelectorAll('input[name="odp"]:checked')).map(el => el.value);

    vybraneOdpovede[cisloOtazky] = oznacene;

    const moznosti = document.querySelectorAll(".odpoved");
    moznosti.forEach(div => {
      const checkbox = div.querySelector('input[name="odp"]');
      const pism = checkbox.value;

      if (spravne.includes(pism) && oznacene.includes(pism)) div.classList.add("correct");
      else if (spravne.includes(pism) && !oznacene.includes(pism)) div.classList.add("partial-correct");
      else if (!spravne.includes(pism) && oznacene.includes(pism)) div.classList.add("incorrect");
      else div.classList.remove("correct", "partial-correct", "incorrect");
    });

    const vseSpravne = spravne.every(s => oznacene.includes(s));
    const ziadneZle = oznacene.every(o => spravne.includes(o));
    if (vseSpravne && ziadneZle) body++;

    if (!auto) {
      document.querySelectorAll('input[name="odp"]').forEach(i => i.disabled = true);
      btnSkontroluj.disabled = true;
    }
  }

  function dalsia() {
    if (!btnSkontroluj.disabled) skontroluj(true);
    index++;
    zobrazOtazku();
  }

  function spat() {
    if (index > 0) { index--; zobrazOtazku(); }
  }

  function ukonciTest() {
    // odstr√°ni posledn√∫ ot√°zku
    otazkaText.textContent = "";
    odpovedeDiv.innerHTML = "";
    progressBox.textContent = "";
    buttons.style.display = "none";

    // skryje n√°zov testu (Biol√≥gia / Ch√©mia)
    nazov.style.display = "none";

    // nov√Ω √∫vodn√Ω text do stredu
    const finishText = document.createElement("div");
    finishText.id = "finishText";
    finishText.textContent = `üéâ Test z ${jeBio ? "Biol√≥gie" : "Ch√©mie"} je dokonƒçen√Ω!`;
    document.getElementById("testContainer").prepend(finishText);

    const percento = Math.round((body / otazky.length) * 100);
    const sprava = percento >= 70
      ? "üéâ Skvel√° pr√°ca! Si READY na prij√≠maƒçky!"
      : "üëç Dobr√Ω v√Ωsledok! E≈°te trochu potr√©nuj.";

    vysledkyDiv.innerHTML = `
    <div class="final-box">
      <h2>${sprava}</h2>
      <p>Z√≠skal si <strong>${body}</strong> z ${otazky.length} ot√°zok (${percento}%).</p>
    </div>
    <div id="scrollPanel" class="scroll-panel"></div>
  `;

    const scrollPanel = document.getElementById("scrollPanel");

    otazky.forEach(o => {
      const otDiv = document.createElement("div");
      otDiv.className = "vysledokOtazka";
      otDiv.innerHTML = `<h3>${o.cislo}. ${o.text}</h3>`;

      const spravne = odpovede.filter(x => x.cislo === o.cislo).flatMap(x => x.odpoved);
      const oznacene = vybraneOdpovede[o.cislo] || [];

      o.odpovede.forEach((odp, j) => {
        const pism = odp.povodnePismeno;
        const div = document.createElement("div");
        div.className = "vysledokOdpoved";
        div.textContent = `${pism}. ${odp.text}`;

        if (spravne.includes(pism) && oznacene.includes(pism)) div.classList.add("correct");
        else if (spravne.includes(pism) && !oznacene.includes(pism)) div.classList.add("partial-correct");
        else if (!spravne.includes(pism) && oznacene.includes(pism)) div.classList.add("incorrect");

        otDiv.appendChild(div);
      });

      scrollPanel.appendChild(otDiv);
    });

    const btnRestart = document.createElement("button");
    btnRestart.textContent = "üîÅ Opakuj test";
    btnRestart.className = "button-restart";
    btnRestart.addEventListener("click", () => window.location.reload());

    const btnDomov = document.createElement("button");
    btnDomov.textContent = "üè† Sp√§≈• na √∫vod";
    btnDomov.className = "button-domov";
    btnDomov.addEventListener("click", () => window.location.href = "index.html");

    vysledkyDiv.appendChild(btnRestart);
    vysledkyDiv.appendChild(btnDomov);
  }


  btnSkontroluj.addEventListener("click", () => skontroluj(false));
  btnDalsia.addEventListener("click", dalsia);
  btnSpat.addEventListener("click", spat);

  zobrazOtazku();
</script>
</body>
</html>
